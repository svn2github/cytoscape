Welcome  to the New Cytoscape Build Process
--------------------------------------------

Alpha Tag:
cytocvs tag Cytoscape2_alpha_2004_4_29

Post C21 tag:
cytocvs tag Cytoscape2_alpha_2004_5_19

I.  Doing a Clean Checkout
==========================

If this is the first time reading this, make sure that you have done a clean checkout.  To
do this, create a backup of your local installation of cytoscape.  Then, set your CVSROOT environment
variable to point to:  /common/cvsdir5.

Then, do a clean check-out:

cvs checkout -P cytoscape

II.  New Directory Structure
============================

Cytoscape now contains the following directory structure:

cytoscape
   +
   +---bin/       Contains all OS specific scripts, e.g. shell scripts and batch files.
   +
   +---build/     This directoy is automatically generated by Ant.  After compilation,
   +              this directory will contain all generated class files.
   +
   +---config/    Contains all configuration files, e.g. cytoscape.props.
   +
   +---cytodocs/  Contains all technical documentation.
   +
   +---dist/      This directory is automatically generated by Ant.  After compilation,
   +              this directory will contain cytoscape.jar.
   +
   +---images/    Contains image files
   +
   +---legacy/    Contains legacy files which will no longer be supported.
   +
   +---lib/       Contains all JAR files.
   +
   +---src/       Contains all source .java files.
   +
   +---testData/  Contains all test data
   +
   +---tools/     Contains misc. tools for cytoscape distribution.
   +
   +---user_docs/ Contains all user documentation and manuals.

III. New Build Process
======================

To build cytoscape:

1.  Download and install Jakarta Ant.  Download from:  http://ant.apache.org/.  Installation instructions
are available at:  http://ant.apache.org/manual/install.html.

2.  To compile cytoscape, type:

ant

3.  To run cytoscape, type:

ant run

If cytoscape appears, everything is set up correctly!

For questions, email Ethan Cerami:  cerami@cbio.mskcc.org.

IV.  Building Cytoscape Plug-Ins
================================

Cytoscape plug-ins are expected to have their own ant build.xml files that can be used to
build JAR files for each plugin.  Also, cytoscape/plugins contains stable plugins that are
made available with the official Cytoscape release.

For old Cytoscape 1.1 plug-ins, you might have to follow these directions:

The csplugins directory uses the same build process as before.  To compile csplugins,
you therefore need to do the following:

define your java CLASSPATH to include at least

    <full-path-to-current-directory>/build/classes
    <full-path-to-immediate-parent-directory>

then, cd to csplugins, and type:

  make

V.  Doing a Full Cytoscape Release
===================================

This section contains notes / tasks for doing a full Cytoscape release.  Doing a full release
of Cytoscape is rather involved.  Some of the tasks are automated and some are manual.

	A.  Core Release Tasks
	----------------------------
	Modify the Cytoscape Version Number in build.xml
		The ant build.xml file contains a property that looks like this:

		<property name="version" value="2.0ALPHA4"/>

		The value of this property is very important as it is used to create
		the final release files.  For example, the final release file for 2.0ALPHA4 will
		be cytoscape-v2.0ALPHA4.tar.gz.

		Update this value to the current version number.

	Tag the Complete Release
		The tag convention we have adopted looks like this:  "cyto-2_0-alpha4".
		Please follow this convention.

		To tag a release:

		cvs tag cyto-2_0-alpha4

	Create the final release files
		To do so, run:  ant zip_release

		The final release files are all placed in cytoscape/zip_release.

		This includes two files:
			a.  a binary .tar.gz file (for Linux / Mac OS X)
			b.  a binary .zip file (for Windows)

	To generate the source distribution, run:  ant source

	Deploy the new release files.
		Currently, we are hosting the release files on cbio.mskcc.org only.
		Release files are located in /var/www/cytoscape/release.

		Obviously, only MSKCC people can perform this task.

	B.  Creating the Mac OS X Release
	---------------------------------------
	See Section VI below for full details.
	
	C.  Creating the InstallAnywhere Release
	-------------------------------------------------

	InstallAnywhere Overview
	------------------------

	Start InstallAnywhere.
	Follow the fairly obvious steps in the Wizard.
	Tweak the parameters (i.e. splash screen + VMs) in the Advanced gui.
	Click "Build"


	Running InstallAnywhere
	-----------------------

	Creating the InstallAnywhere release requires a local 
	installation of the InstallAnywhere product.  It is available 
	here: http://www.macrovision.com for the small cost of your 
	first and second born children.  If you're a member of the Ideker
	lab at UCSD, then you may use the version at 
	/cellar/software/InstallAnywhere/InstallAnywhere. It is possible
	that you will need a key to properly run InstallAnywhere, if
	so, simply recursively copy the directory:
	/cellar/users/mes/.InstallAnywhere

	It is possible to download InstallAnywhere and run it as a 
	trial version.  With some difficulty you'll be able to create
	a project, but the actual install files you create will "expire"
	three days after creating them.  Therefore, we do NOT recommend
	this approach.


	Creating a Release
	------------------

	The first step is to get a .zip or .tar.gz file of the final
	release to be distributed.  Unpack this file into an 
	accessible directory.

	Start InstallAnywhere:

		% /cellar/software/InstallAnywhere/InstallAnywhere

	Select the "Create New Project" option.

	Click "Save As" to choose a name for your project, e.g.

		Cytoscape-v2.2
	
	Make the install file name something like:

		Cytoscape-v2.2_install

	Click next.

	You should probably just click next throught the "Project Info"
	page unless you have a good reason for changing something.
	This page should be populated with the name you chose earlier
	via the "Save As" button.

	Next add the files.  Click the "Add Files..." button, 
	select the directory where you unpacked the final release
	described above, and click "Add All".  This will add all files
	from the release directory to the InstallAnywhere package.  
	Click done and next.

	Next choose the main class.  Type the full package name of
	the main class into the text box on the left of the wizard. 
	InstallAnywhere doesn't seem to be able to find the main class
	on its own.  Cytoscape's main class is:
		
		cytoscape.CyMain

	If we had our own icon, we could change to it here.  Since
	we don't, just click next.

	Next you need to specify all of the jar files that need to be 
	in the CLASSPATH.  To do this, either click on the lib 
	directory and then select each individual jar file and
	click the checkbox on the right, or simply click the 
	"Automatically set Classpath" button.  The icons next to each
	jar file name should change.  Make sure that each jar file
	in the lib directory is selected as well was as cytoscape.jar.

	Finally select the platforms you'd like to build installers
	for.  At the very least you should select the Windows without
	virtual machine option.  If you'd like to do more and include
	the virtual machines with the release files, click on the 
	Advanced Project Designer button, then the "Build" tab on the
	left of the new screen that pops up.  NOTE:  because of Mac
	incompatibilities, we do NOT include a Mac OSX InstallAnywhere
	file.

	One last (optional) step is to specify the splash screen for the 
	download website.  To do this, you'll need to check cytoscape out 
	from CVS. Then, from the Advanced Project Designer, click on the
	"Installer UI" and "Look 'n Feel" tabs on the left.  In the
	"Startup Splash Screen Image" box select the splash image from
	the cytoscape directory you just checked out:

		~/cytoscape/images/CytoscapeSplashScreen.png

	To create the release files, from either the basic wizard or 
	the advanced designer, click the build option (available on the 
	"Build" tab in the advanced designer).  Once you click build, 
	InstallAnywhere will go about creating the releases you requested.  
	The files will be put in the project directory you specified above 
	in the PROJECT_NAME_Build_Output/Web_Installers directory.  

	Once the release files have been created, simply copy the 
	contents of the Web_Installers to the website where the code 
	will be made available to the public.

	Finally, VERIFY THAT THE RELEASES WORK!!!!!


	D.  Update Cytocape.org Web Site
	-------------------------------------------------
	Make sure the Cytoscape Manual (PDF) is Up-to-Date
		We currently keep a copy of CytoscapeX_YManual.pdf checked into
		two places:  cytscape/user_docs and cyto_web/manual.  cytoscape/user_docs is
		the definitive one, and cyto_web/manual is the copy.

		Before doing a full release, make sure to copy the latest manual from
		cytoscape/user_docs to cyto_web/manual, and check in the latest version.

	Update cyto_web/config.php

		This file contains global configurations for cytoscape.org
		You will probably need to add variable links for the newly released 
		version of Cytoscape.

	Deploy Everything to cytoscape.org
		To do so, update cyto_web/cyto.properties with a valid user/password.
		If you don't have one, email Trey or Ethan.

		Then, type:  ant deploy.

	Copy over the latest Javadocs.
		Latest Javadocs are currently hosted on cbio.mkscc.org, and are not part
		of cytoscape.org.  That's mainly because cytoscape.org FTP connection is so slow.

		First, copy over the source code from the task framework.  We want the API for
		this framework to be included in the global 2.1 Javadoc, and this is the easiest
		way to do it.  The code is currently located in
		csplugins/common/task/src/cytoscape/task.  In the future, we should probably
		come up with an automated way of doing this.
		
		Second, run:  ant doc.

		Then, tar/gzip everything in the API directory.

		scp the gzip file to /var/www/cytoscape/javadoc and unpack.
	
VI:  Creating a Mac OS X Release
================================

This section describes the full procedure for creating a Mac OS X release.  
Note that some of the steps are automated, and some require manual work.

To create the Mac OS X Release:

		1.  run ant task:  ant mac
		
		Doing so will create a directory called Cytoscape.app.
		It will be located in build/cytoscape-vX.Y.
		
		Cytoscape.app has a Cytoscape icon, and the end-user will double click
		on it to start Cytoscape.
		
		2.  Start PackageMaker
		
		PackageMaker is a handy, free utility for Mac OS X that enables you to
		build professional looking installation scripts.
		
		By default, PackageMaker is located in Applications/Utilities.
		
		3.  Within PackageMaker, select File -> Open, and select that Cytoscape
		Package template at:  tools/installers/mac_os_x/Cytoscape.psmp.
		
		This template is based on an installation done on Ethan's machine,
		and you will need to tweak it to get it to work on your machine.
		
		In particular, you may need to update the following:
		
		a.  Under the "Description" tab, you may need to update the Version #.
		b.  Under the "Files" tab, you may need to update the absolute path.
			It should point to:  cytoscape/build/cytoscape-v2.2
		c.  Under the "Resources" tab, you may need to update the absolute path.
			It should point to: cytoscape/tools/installers/mac_os_x/resources.
			
			Note that the resources directory contains the Welcome and License 
			files used during installation.
			
		d.  Under the "Version" tab, you may need to update the version #s and strings.
		
		4.  Within PackageMaker, select File -> Create Package
			Name the package like this:  cytoscape-vX.Y.pkg
			
		5.  Verify that the Installer actually works.  Just double click on
			cytoscape-vX.Y.pkg and go through the installation steps.
			
		6.  Create a Mac OS X Disk Image for Internet distribution.
			a.  this is done manually via the Mac Disk Utility program.
			b.  in Disk Utility, click "New Image", specify the name 
				"cytoscape-vX.Y", and select 100 MB.
			c.  once the image is created on your desktop, double click on
				the disk image icon for cytoscape, and copy 
				the complete cytoscape-vX.Y.pkg to the image.
				
		7.  Finally, create the dmg.zip file
			a.  to do so, right click on cytoscape-vX.Y.dmg, and 
				select "Create Archive".  
			
			(Note:  When you created the disk image via Disk Utility, it 
			creates two items:  1)  the actual .dmg file;  and
			2) the opened dmg file, displayed as a disk icon.  To create the
			archive, right click on the actual .dmg file, not the disk icon.)

	Deploy the new release file
		As in the section above, we are currently hosting the release files on
		cbio.mskcc.org only.  Release files are located in /var/www/cytoscape/release.

	For future reference, the Mac OS X release in based on the followings documents:
	1.  Java Deployment Options for Mac OS X
http://developer.apple.com/documentation/Java/Conceptual/Java14Development/03-JavaDeployment/JavaDeployment.html#//apple_ref/doc/uid/TP40001885-SW1
	(see section on:  Mac OS X Application Bundles)
	2.  A Quick Look at PackageMaker and Installer
http://developer.apple.com/documentation/DeveloperTools/Conceptual/SoftwareDistribution/Concepts/sd_install_quick_look.html#//apple_ref/doc/uid/20001760-TPXREF2

