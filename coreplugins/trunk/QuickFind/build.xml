<?xml version="1.0"?>
<!--
	QuickFind Ant Build Script.
	Author:  Ethan Cerami
-->

<project name="QuickFind" default="all" basedir=".">

    <!-- The build directory -->
    <!-- All files generated by ant go here -->
    <property name="build.dir"    value="${basedir}/build"/>

    <!-- The java source directory-->
    <property name="src.dir"      value="${basedir}/src"/>

    <!-- The lib directory -->
    <!-- Contains all third-party JAR files, required for compilation -->
    <property name="lib.dir"       value="lib"/>

    <!-- The dist directory -->
    <property name="dist.dir"    value="${basedir}/plugins"/>

    <!-- The config directory -->
    <property name="config.dir"    value="${basedir}/config"/>

    <!-- ============= Custom Ant Task Definitions ======================= -->
  	<taskdef resource="checkstyletask.properties"/>

	<!--  ============ Compilation Control Options ======================= -->
  	<property name="compile.debug"       value="true"/>
  	<property name="compile.deprecation" value="true"/>
  	<property name="compile.optimize"    value="true"/>

	<!-- ==================== Compilation Classpath ====================== -->
    <!--
        NB:  Compilation classpath assumes that main cytoscape project is checked out,
        and compiled.
    -->
    <path id="compile.classpath">
		<pathelement path="${build.dir}/classes"/>
		<fileset dir="../../cytoscape/${lib.dir}">
       		 	<include name="*.jar"/>
		</fileset>
         <fileset dir="../../cytoscape/">
                     <include name="cytoscape.jar"/>
         </fileset>
  	</path>

    <!-- ==================== Clean Target =============================== -->
    <target name="clean"
        description="Deletes all build files and starts fresh">
        <delete dir="${build.dir}"/>
        <delete dir="${dist.dir}"/>
    </target>

    <!-- ==================== Compile Target ==============================-->
    <target name="compile" depends="prepare"
        description="Compiles all Java source files">
        <mkdir dir="${build.dir}/classes"/>
        <javac srcdir="${src.dir}"
		   source="1.5"
		   target="1.5"
            destdir="${build.dir}/classes"
            debug="${compile.debug}"
            deprecation="${compile.deprecation}"
            optimize="${compile.optimize}">
        <classpath refid="compile.classpath"/>
        </javac>
    </target>

    <!-- ==================== Jar Target ============================== -->
    <target name="jar" depends="compile"
            description="Creates Plugin Jar:  quick_find.jar">
		<copy file="${config.dir}/plugin.props" todir="${build.dir}/classes/csplugins/quickfind/plugin"/>
        <jar destfile="${dist.dir}/quick_find.jar"
             basedir="${build.dir}/classes">
	     <manifest>
	     	<attribute name="Cytoscape-Plugin" 
		           value="csplugins.quickfind.plugin.QuickFindPlugIn"/>
	     </manifest>
	</jar>
    </target>

    <!-- ==================== Run Target ============================== -->
    <target depends="jar" description="Runs Latest Version of Cytoscape with QuickFind Plugin"
        name="run">
        <copy todir="${dist.dir}">
            <fileset dir="../../cytoscape/plugins/core"/>
        </copy>
        <java classname="cytoscape.CyMain" classpathref="compile.classpath"
            fork="true" maxmemory="1000M">
            <arg line="-N ../../cytoscape/testData/galFiltered.sif -m ../../cytoscape/testData/galExpData.pvals -p plugins"/>
        </java>
    </target>

    <!-- ==================== Build and test jar ============================== -->
    <target name="all" depends="jar"/>

    <!-- ==================== Prepare Target ============================== -->
    <target name="prepare">
        <!-- Create build directories as needed -->
        <mkdir  dir="${build.dir}"/>
        <mkdir  dir="${dist.dir}"/>
        <mkdir  dir="${build.dir}/classes"/>

        <!--  Copy over images / icons -->
        <copy todir="${build.dir}/classes">
          <fileset dir="${src.dir}">
            <include name="**/*.gif"/>
	    <include name="**/*.png"/>
          </fileset>
        </copy>
    </target>

    <!-- ==================== JUnit Test Target =========================== -->
    <target name="test" description="Runs all JUnit tests" depends="compile">
            <junit printsummary="yes" fork="yes" haltonfailure="yes">
            <formatter type="plain" usefile="false"/>
            <test name="csplugins.test.AllTest"/>
            <classpath refid="compile.classpath"/>
        </junit>
    </target>

    <!-- ==================== Checkstyle Target =========================== -->
    <!--
        Target to Run CheckStyle on all Source Code
        Uses the Sun Coding Conventions Configuration
    -->
    <target name="check" description="Runs CheckStyle on all source code">
        <checkstyle config="${config.dir}/sun_checks.xml">
            <fileset dir="${src.dir}/csplugins">
                <include name="**/*.java"/>
            </fileset>
        </checkstyle>
    </target>
</project>
